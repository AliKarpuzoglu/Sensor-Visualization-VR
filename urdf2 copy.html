<!DOCTYPE html>
<html>
<head>

<!-- <script src="https://static.robotwebtools.org/threejs/current/three.js"></script> -->

<script src="https://unpkg.com/three@0.119.0/build/three.js"></script>
 <script src="STLLoader.js"></script>

<!--<script src="https://static.robotwebtools.org/threejs/r89/ColladaLoader.js"></script>
<script src="https://static.robotwebtools.org/ros3djs/0.18.0/ColladaLoader.js"></script> -->
<script src="https://aframe.io/releases/1.0.4/aframe.js"></script>
<script src="https://unpkg.com/aframe-input-mapping-component/dist/aframe-input-mapping-component.min.js"></script>
<script src="aframe-teleport-controls.js"></script>
<script src="https://static.robotwebtools.org/EventEmitter2/current/eventemitter2.js"></script>
<script src="https://static.robotwebtools.org/roslibjs/current/roslib.js"></script>
<script src="ros3d.js"></script>


<script>
	var viewer;
  /**
   * Setup all visualization elements when the page is loaded.
   */
  async function init_env() {
    var rootObjectScene = document.getElementById('robot-element-parent').object3D

    // Connect to ROS.
    var ros = new ROSLIB.Ros({
      url : 'wss://192.168.2.110:9090'
    });
    emitter = new EventEmitter2();
    emitter.on('change',function(){
console.log(" hallo")

    })

    // Setup a client to listen to TFs.
    var tfClient = new ROSLIB.TFClient({
      ros : ros,
      angularThres : 0.01,
      transThres : 0.01,
      rate : 10.0,
     fixedFrame: '/world' 
    });

    // Setup the URDF client.
    var urdfClient = new ROS3D.UrdfClient({
      ros : ros,
      tfClient : tfClient,
      path : 'https://192.168.2.110:8080/',
      // rootObject : viewer.scene
      rootObject : rootObjectScene
    });


   

  await new Promise(r=> setTimeout(r,2000));
  rootObjectScene.add(new ROS3D.Grid());

 setTimeout(function(){ 
   let scene_elements = rootObjectScene.children;
   scene_elements.forEach(element=>{
  //  if(element.children.length>4){
   element.lookAt(0,1,0);
  })
 
},6000)

  };
 
</script>
</head>

<body onload="init_env()">
  <a-scene   id="main" >
  <a-entity id="rig" position="0 0 0">
    <a-entity id="camera" camera look-controls wasd-controls="acceleration:100" position="0 1.3 0"></a-entity>
    <!-- hand controls abstract 6dof controllers-->
    <a-entity teleport-controls="cameraRig: #rig"
              laser-controls="hand: left;">
    </a-entity>   
    <a-entity teleport-controls="type: line; cameraRig: #rig"
              laser-controls="hand: right;">                
    </a-entity>
  </a-entity>
  <a-entity  position="0 0 0" id='robot-element-parent'></a-entity>

	      <a-box position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9"></a-box>
  
      <!-- <a-plane position="0 0 0" rotation="-90 0 0" width="4" height="4" color="#7BC8A4"></a-plane>
      <a-sky color="#ECECEC"></a-sky>
	 -->
</a-scene>
</body>
</html>

